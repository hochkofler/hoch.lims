<tal:report>

    <!-- REPORT CONTROLS -->
    <tal:t replace="structure python:view.render_controls(context, **options)" />

    <!-- REPORT JS -->
    <tal:t replace="structure python:view.render_js(context, **options)" />

    <!-- REPORT CSS -->
    <tal:t replace="structure python:view.render_css(context, **options)" />

    <!-- REPORT COA -->
    <tal:COA define="collection python:view.collection;
                    model python:view.model;
                    model_summary python:collection[0];
                    batch python:model_summary.getBatch();
                    batch_number python:batch.getId();
                    batch_expire python: batch.ExpirationDate.strftime('%m-%y');
                    product model_summary/Batch/Product;
                    mktauth product/MarketingAuthorization" i18n:domain="hoch.lims">
        <div>

            <table class="tg no-break">
                <colgroup>
                    <col style="width: 33%;">
                    <col style="width: 37%;">
                    <col style="width: 30%;">
                </colgroup>
                <tr>
                    <td colspan="3" class="label noborder-bottom label">
                        <span>Dpto. CONTROL DE CALIDAD</span>
                    </td>
                </tr>
                <tr>
                    <td colspan="3" class="text-center noborder-vertical label">
                        <span>CERTIFICADO DE CONTROL DE CALIDAD-PRODUCTO TERMINADO</span>
                    </td>
                </tr>
                <tr>
                    <td colspan="1" class="label">
                        <span class="colon-after">PRODUCTO</span>
                    </td>
                    <td colspan="2" class="label">
                        <span tal:content="mktauth/TradeName"></span>
                    </td>
                <tr>
                    <td colspan="1" class="label">
                        <span class="colon-after">D.C.I.</span>
                    </td>
                    <td colspan="2">
                        <span tal:content="mktauth/GenericName"></span>
                    </td>
                </tr>
                <tr>
                    <td colspan="1" class="label">
                        <span class="colon-after">CONCENTRACIÓN</span>
                    </td>
                    <td colspan="2">
                        <span>POR IMPLEMENTAR</span>
                    </td>
                </tr>
                <tr>
                    <td colspan="1" class="label">
                        <span class="colon-after">LABORATORIO PRODUCTOR</span>
                    </td>
                    <td colspan="1" class="label">
                        <span>LABORATORIOS IFA S.A.</span>
                    </td>
                    <td colspan="1">
                        <span class="colon-after"><strong>REGISTRO SANITARIO</strong></span><br>
                        <span tal:content="mktauth/RegistrationNumber"></span>
                    </td>
                </tr>
                <tr>
                    <td colspan="1" class="label">
                        <span class="colon-after">FECHA DE FABRICACIÓN</span>
                    </td>
                    <td colspan="1">
                        <span>POR IMPLEMENTAR</span>
                    </td>
                    <td colspan="1">
                        <span class="colon-after"><strong>FORMA FARMACÉUTICA</strong></span><br>
                        <span tal:content="mktauth/DosageForm"></span>
                    </td>
                </tr>
                <tr>
                    <td colspan="1" class="label">
                        <span class="colon-after">FECHA DE VENCIMIENTO</span>
                    </td>
                    <td colspan="1">
                        <span tal:content="batch_expire"></span>
                    </td>
                    <td colspan="1">
                        <span class="colon-after"><strong>N° CERTIFICADO C. DE C.</strong></span><br>
                        <span>POR IMPLEMENTAR</span>
                    </td>
                </tr>
                <tr>
                    <td colspan="1" class="label">
                        <span class="colon-after">N° LOTE</span>
                    </td>
                    <td colspan="1">
                        <span>
                            <a tal:content="batch/ClientBatchID"
                            tal:attributes="href batch/absolute_url"></a></span>
                    </td>
                    <td colspan="1">
                        <span class="colon-after"><strong>FECHA DE ANÁLISIS</strong></span><br>
                        <span>POR DEFINIR</span>
                    </td>
                </tr>
                <tr>
                    <td colspan="1" class="label">
                        <span class="colon-after">CANTIDAD</span>
                    </td>
                    <td colspan="1">
                        <span tal:content="python: batch.ReleasedBatchSize"></span><span> POR IMPLEMENTAR</span>
                    </td>
                    <td colspan="1">
                        <span class="colon-after"><strong>INSTITUCIÓN</strong></span><br>
                        <span tal:content="python: batch.getLabelNames()[0] or 'Comercio'">POR IMPLEMENTAR</span>
                    </td>
                </tr>
                <tr>
                    <td colspan="3">
                        <span class="colon-after"><strong>PRESENTACIÓN</strong></span>
                        <span tal:content="product/Presentation"></span>
                        <br>
                        <span class="colon-after"><strong>VÍA DE ADM</strong></span>
                        <span tal:content="mktauth/AdministrationRoute"></span>
                    </td>
                </tr>
                <tr>
                    <td colspan="1" class="text-center label">
                        <span>TIPO DE ANÁLISIS</span>
                    </td>
                    <td colspan="1" class="text-center label">
                        <span>ESPECIFICACIONES</span>
                    </td>
                    <td colspan="1" class="text-center label">
                        <span>RESULTADOS</span>
                    </td>
                </tr>
                <tal:categories tal:define="analyses_by_category python:view.get_analyses_by_category(collection);"
                    tal:repeat="category python:view.sort_items(analyses_by_category)">
                    <tr tal:define="length_analyses_by_category python:len(view.get_analyses_by(collection, category=category))"
                        tal:condition="length_analyses_by_category">
                        <td colspan="3" class="text-center label">
                            <span tal:content="category/Title">Category</span>
                        </td>
                    </tr>
                    <tal:services
                        tal:define="services python:view.group_items_by('Keyword',view.get_analyses_by(collection, category=category))"
                        tal:repeat="service services">
                        <tr tal:define="analyses python:view.get_analyses_by(collection, category=category, keyword=service);
                                    analysis python: analyses[0];
                                    is_numeric python:all(r == 'numeric' for r in [a.getResultType() for a in analyses]);
                                    specs python: model.get_formatted_specs(analysis);
                                    unit python:model.get_formatted_unit(analysis)">
                            <td class="analysis noborder-vertical align-middle">
                                <span tal:condition="not:analysis/ScientificName">
                                    <span class="font-weight-normal" tal:content="analysis/title"></span>
                                </span>
                                <span tal:condition="analysis/ScientificName">
                                    <span class="font-italic" tal:content="analysis/title"></span>
                                </span>
                            </td>
                            <td class="noborder-vertical text-center align-middle">
                                <span tal:content="specs">specs</span>
                                <span class="units" tal:condition="specs" tal:content="structure unit"></span>
                            </td>
                            <td class="noborder-vertical text-center align-middle">
                                <tal:numeric_result tal:condition="is_numeric">
                                    <span
                                        tal:define="avg python:sum([float(a.getFormattedResult()) for a in analyses])/len(analyses)"
                                        tal:content="avg">Result numeric</span>
                                </tal:numeric_result>
                                <tal:non_numeric_result tal:condition="not:is_numeric">
                                    <span
                                        tal:define="unique_results python:set([a.getFormattedResult() for a in analyses])"
                                        tal:content="python: ', '.join(unique_results)">>Result non-numeric</span>
                                </tal:non_numeric_result>
                                <span class="units" tal:content="structure unit"></span>
                            </td>
                        </tr>
                    </tal:services>
                </tal:categories>
                <tal:signatures>
                    <tr>
                        <td colspan="2">
                            <span><strong>REFERENCIAS:</strong></span>
                            <span>Análisis de valoración realizados según técnica propia de
                                laboratorio y el análisis</span>
                        </td>
                        <td>
                            <span><strong>DICTAMEN:</strong></span><br>
                            <span><strong>APROBADO</strong></span>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2" rowspan="4" class="align-top-left signature-space label colon-after">
                            <stron>OBSERVACIONES</stron>
                        </td>
                        <td>Fecha: 15-04-2025</td>
                    </tr>
                    <tr>
                        <td><br>Silvia Pacha<br>ANALISTA INSTRUMENTAL</td>
                    </tr>
                    <tr>
                        <td><br>Silvia Pacha<br>ANALISTA INSTRUMENTAL</td>
                    </tr>
                    <tr>
                        <td><br>Silvia Pacha<br>ANALISTA INSTRUMENTAL</td>
                    </tr>
                </tal:signatures>
            </table>
        </div>
    </tal:COA>


</tal:report>